flowchart TB
  classDef pkg fill:#f8f9fa,stroke:#dfe6ee,stroke-width:1px
  classDef sdk fill:#fff0f6,stroke:#ffd6e0
  classDef browser fill:#e6f7ff,stroke:#a9d8ff
  classDef tools fill:#fff7e6,stroke:#ffe7b5

  subgraph Monorepo[Monorepo with pnpm workspace]
    direction TB
    vanilla[packages/vanilla<br/>loadParallel function<br/>- injects script tag<br/>- awaits window.Parallel]:::pkg
    react[packages/react<br/>ParallelProvider<br/>useParallel hook<br/>PassportButton]:::pkg
    examples[examples<br/>react-webpack<br/>webpack]:::pkg
  end

  Browser[Browser Application<br/>imports SDK packages<br/>calls loadParallel]:::browser

  Remote[Remote Parallel SDK<br/>app.parallelmarkets.com<br/>SDK v2<br/>- window.Parallel<br/>- auth.statusChange]:::sdk

  Tools[Build Tooling<br/>Rollup<br/>TypeScript<br/>Jest<br/>ESLint]:::tools

  Browser -->|imports| vanilla
  Browser -->|optional imports| react
  react -->|depends on| vanilla
  vanilla -->|loads script| Remote
  Remote -->|provides API| Browser
  Browser -->|API calls| Remote
  Tools --> vanilla
  Tools --> react

  subgraph Errors[Failure Modes]
    direction LR
    loadErr[Remote SDK load error<br/>loadParallel rejects]:::sdk
    ssr[Server-side SSR<br/>loadParallel returns null]:::pkg
    multiCall[Multiple calls<br/>Promise rejects]
  end

  Remote -.->|on error| loadErr
  Browser -.->|on server| ssr
  Browser -.->|if called multiple times| multiCall